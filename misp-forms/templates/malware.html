{% extends "base.html" %}

{% block title %}Report Malware Infection{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2><i class="fas fa-virus"></i> Report Malware Infection</h2>
    <p class="info-box">
        Malware (short for malicious software) is any software designed to harm, steal, or disrupt a computer, network, or device. Hackers use malware to steal personal information, spy on users, damage files, or even take control of entire systems.
        Malware comes in different forms, like viruses, ransomware, spyware, and trojans, each with its own way of causing trouble.
        <br>

    </p>


    <!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="flash-message {{ category }}">
        {{ message|safe }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}


    <form method="POST" action="{{ url_for('malware.malware') }}" enctype="multipart/form-data" onsubmit="showSpinner()">


        <!-- organisation Selection -->
        <h5>Organisation</h5>
        <div class="mb-3 p-3 border rounded" style="border: 2px solid #178f8f;">
            <label for="organisation" class="form-label">Select organisation (Required)</label>
            <select class="form-control" name="organisation" id="organisation" required>
                <option value="" disabled selected>Select an organisation</option>
                {% for org in available_organisations %}
                <option value="{{ org }}">{{ org }}</option>
                {% endfor %}
            </select>
        </div>


        <!-- Sharing Options -->
<h5>Sharing Options</h5>


        <div class="mb-3 p-3 border rounded" style="border: 2px solid #178f8f;">
            {% include 'event_sharing_lite.html' %}
        </div>


        <!-- Incident Details -->
        <h5>Incident Details {% with href="https://mkdocs.underserved.org" %} {% include 'help.html' %} {% endwith %}</h5>
        <div class="mb-3 p-3 border rounded" style="border:2px solid #178f8f;">

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="date" class="form-label">Date of Infection/Detection: (Required)</label>
                    <input type="date" class="form-control" name="date" id="date" value="{{ today_date }}" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="time" class="form-label">Time:(Approx)</label>
                    <input type="time" class="form-control" name="time" id="time">
                </div>
            </div>

            <div class="form-group">
                <label for="malware_name">Malware Name:</label>
                <input type="text" class="form-control" name="malware_name" id="malware_name" required>
            </div>

            <div class="form-group">
                <label for="malware_type">Malware Type: </label>
                <select class="form-control" name="malware_type" id="malware_type" required>
                    <option value="">Select Malware Type</option>
                    <option value="Ransomware">Ransomware</option>
                    <option value="Trojan">Trojan</option>
                    <option value="Worm">Worm</option>
                    <option value="Spyware">Spyware</option>
                    <option value="Adware">Adware</option>
                    <option value="Botnet">Botnet</option>
                    <option value="Rootkit">Rootkit</option>
                    <option value="Keylogger">Keylogger</option>
                    <option value="Cryptojacker">Cryptojacker</option>
                    <option value="Other">Other (add details in description)</option>
                    <option value="Unknown">Don't know</option>
                </select>
            </div>

            <div class="form-group">
                <label for="payload_installation">Payload Installation Method: </label>
                <input type="text" class="form-control" name="payload_installation" id="payload_installation" placeholder="e.g., Dropped by another malware, Exploit kit, Phishing email">
            </div>

            <div class="form-group">
                <label for="description">Description:</label>
                <textarea class="form-control" name="description" id="description" rows="4" placeholder="PProvide a description of the incident." required></textarea>
            </div>

            <div class="form-group">
                <label for="infection_vector">Infection Vector: </label>
                <input type="text" class="form-control" name="infection_vector" id="infection_vector" placeholder="How did the malware infect the system? (e.g., email attachment, phishing link)">
            </div>

            <div class="form-group">
                <label for="affected_systems">Affected Systems:</label>
                <textarea class="form-control" name="affected_systems" id="affected_systems" rows="4" placeholder="List the affected systems, e.g., server names or IP addresses."></textarea>
            </div>


            <div class="mb-3">
                <label for="vulnerability" class="form-label">Exploited Vulnerability</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="vulnerability" name="vulnerability" placeholder="Enter the vulnerability (optional)">
                    <a href="https://vulnerability.circl.lu" class="btn btn-outline-info" target="_blank" rel="noopener noreferrer">
                        <img src="{{ url_for('static', filename='images/cve.png') }}" alt="CVE" style="height: 22px; width: 22px; margin-right: 5px;"> Vulnerability Lookup
                    </a>
                </div>
            </div>

            <div class="mb-3">
                <label for="threat_actor" class="form-label">Threat Actor</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="threat_actor" name="threat_actor" placeholder="Enter Threat Actor name (optional)">
                    <a href="https://attack.mitre.org/groups/" class="btn btn-outline-info" target="_blank" rel="noopener noreferrer">
                        <img src="{{ url_for('static', filename='images/threat_actor.png') }}" alt="CVE" style="height: 22px; width: 22px; margin-right: 5px;"> Threat Actors
                    </a>
                </div>
            </div>

            <div class="form-group">
                <label for="malware_file">Upload Malware Sample (Optional):</label>
                <input type="file" class="form-control" name="malware_file" id="malware_file" accept=".exe,.dll,.bin,.jar,.ps1,.vbs,.js" multiple>
                <small class="form-text text-muted">Allowed file types: .exe, .dll, .bin, .jar, .ps1, .vbs, .js</small>
            </div>


        </div>

        {% include 'spinner.html' %}

        <div class="text-center">
            <button type="submit" class="btn custom-btn mt-3">Submit Report</button>
        </div>
    </form>
</div>

{% endblock %}
